#! /usr/bin/env sclang

// lib/drums_recorder.scd defines the schema for the drum archive
var drumArchivePath = thisProcess.argv[0].absolutePath;
var renderDrumArchive = requireRelative("../lib/render_drum_archive.scd")[0];
var drumArchive;

if (("stat " ++ drumArchivePath).unixCmd != 0) {
  "****************************************************************".postln;
  ("Cannot stat drum archive file at " ++ drumArchivePath).postln;
  "Are you sure it exists?".postln;
  "Exiting...".postln;
  "****************************************************************".postln;
  1.exit;
};

drumArchive = drumArchivePath.load;

drumArchive.keysValuesDo {|name, recordCollection|
  var samplePath = ("../" ++ recordCollection[\relativePath]).resolveRelative;

  renderDrumArchive.value(name, samplePath, recordCollection[\events], drumArchivePath);
};

0.exit;
